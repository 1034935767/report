<?xml version="1.0" encoding="UTF-8"?> 
<beans xmlns="http://www.springframework.org/schema/beans" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p" 
    xmlns:context="http://www.springframework.org/schema/context" 
    xmlns:jee="http://www.springframework.org/schema/jee" xmlns:tx="http://www.springframework.org/schema/tx" 
    xmlns:aop="http://www.springframework.org/schema/aop"   xmlns:sfpay-mvc="http://www.sf-pay.com/schema/sfpay-mvc"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd  
	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd
	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
	http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.2.xsd
	http://www.sf-pay.com/schema/sfpay-mvc http://www.sf-pay.com/schema/framework2-mvc.xsd"> 
   <sfpay-mvc:config>
        <sfpay-mvc:message-converter bean-name="jacksonHttpMessageConverter" />
        <sfpay-mvc:filter-chain-proxy bean-name="filterChainProxy">
               <list>
                      <bean class="org.springframework.web.filter.CharacterEncodingFilter">
                             <property name="encoding" value="UTF-8" />
                             <property name="forceEncoding" value="true" />
                      </bean>
                      <ref local="distributedSessionFilter" />
               </list>
        </sfpay-mvc:filter-chain-proxy>
	</sfpay-mvc:config>

    <!--redis sentinel 配置-->
  <bean id="redisSentinelConfiguration" class="org.springframework.data.redis.connection.RedisSentinelConfiguration" >
  <constructor-arg index="0" value="${master}" />
  <constructor-arg index="1">
  <set>
    <value>${redis1.url}</value>
    <value>${redis2.url}</value>
    <value>${redis3.url}</value>
  </set>
   
  </constructor-arg>
   
  </bean>
   
    <bean id="jedisConnectionFactory" class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory" p:password="${redis.pass}" p:timeout="${redis.timeout}"  >
        <constructor-arg index="0" ref="redisSentinelConfiguration"></constructor-arg>
        <constructor-arg index="1" ref="jedisPoolConfig"></constructor-arg>
        </bean> 
     <bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate" p:connection-factory-ref="jedisConnectionFactory" />
     
      <bean id="redisSessionDao" class="com.sfpay.framework2.web.session.SpringDataRedisSessionDao" >
    <property name="redisTemplate" ref="redisTemplate"></property>
    </bean>
    <bean id="jedisPoolConfig" class="redis.clients.jedis.JedisPoolConfig"> 
        <property name="maxIdle" value="${redis.maxIdle}" /> 
        <property name="maxTotal" value="${redis.maxActive}" /> 
        <property name="minIdle" value="${redis.maxWait}" /> 
        
    </bean>
    
    <bean id="distributedSessionFilter"
       class="com.sfpay.framework2.web.session.DistributedSessionFilter">
        <property name="distributedSessionManager">
               <bean
                      class="com.sfpay.framework2.web.session.DefaultDistributedSessionManager">
                      <property name="distributedSessionDao">
                             <ref bean="redisSessionDao" />
                      </property>
                      <property name="sessionCookieName" value="SFPAY_REPORT_JSESSIONID" />
               </bean>
        </property>
	</bean>
     
     
      
</beans>